# 前后端开发同步策略

## 📋 推荐策略：阶段化同步开发

**核心原则**：每个开发阶段完成后，前端跟进实现该阶段的功能，而不是等所有后端功能完成后再开发前端。

---

## 🎯 为什么推荐阶段化同步开发？

### ✅ 优点

1. **及早发现接口设计问题**
   - 前端实际使用时能发现接口设计的不足
   - 避免后端全部完成后才发现需要大量返工

2. **可演示的增量进度**
   - 每个阶段完成后都有可用的功能
   - 便于向 stakeholders 展示进度

3. **减少集成风险**
   - 分阶段集成，问题更容易定位和解决
   - 避免最后一次性集成时的大量问题

4. **保持开发节奏**
   - 前端不会被长时间阻塞
   - 后端可以专注于当前阶段的实现

### ⚠️ 其他策略的缺点

**完全分离开发**（等后端全部完成）：

- ❌ 接口设计问题发现太晚，返工成本高
- ❌ 无法及时验证 API 的易用性
- ❌ 最后集成时可能发现大量不兼容问题

**完全同步开发**（前后端同时开始）：

- ❌ 前端需要大量 mock 数据，可能做无用功
- ❌ 接口频繁变更会导致前端重复开发
- ❌ 效率较低

---

## 📅 具体实施计划

### 第一阶段：用户认证（已完成 ✅）

**后端完成内容：**

- ✅ 用户注册/登录
- ✅ JWT Token 刷新
- ✅ 用户资料管理

**前端应该实现的：**

- ✅ 登录/注册页面
- ✅ Token 存储和管理（localStorage）
- ✅ API 客户端封装（axios/fetch）
- ✅ 用户资料页面

**实施建议：**

- 前端可以开始实现第一阶段的功能
- 使用真实的后端 API，不需要 mock

---

### 第二阶段：文档 CRUD 和权限管理（进行中 🔄）

**后端计划完成：**

- 🔄 文档 CRUD 接口
- 🔄 ACL 权限管理
- 🔄 文档版本管理

**前端应该实现的：**

- 📋 文档列表页面
- 📋 文档创建/编辑页面
- 📋 文档详情页面
- 📋 权限管理界面（ACL 设置）
- 📋 版本历史查看

**实施建议：**

- 等第二阶段后端完成后，前端再开始实现
- 或者在后端开发过程中，前端可以先搭建页面框架和路由

---

### 第三阶段：实时协作（计划中 📅）

**后端计划完成：**

- 📅 协作 WebSocket 接入
- 📅 快照回调处理
- 📅 协作令牌生成

**前端应该实现的：**

- 📅 Tiptap 编辑器集成
- 📅 Yjs CRDT 集成
- 📅 WebSocket 连接管理
- 📅 实时协作 UI（光标、用户列表）

**实施建议：**

- 这个阶段前后端必须紧密配合
- 建议前后端同步开发，因为需要频繁测试协作功能

---

## 🛠️ 前端开发准备

### 1. 技术栈选择

根据设计文档，前端技术栈为：

- **框架**：React + TypeScript
- **编辑器**：Tiptap (ProseMirror)
- **协作**：Yjs + y-websocket
- **HTTP 客户端**：axios 或 fetch
- **状态管理**：Redux / Zustand / Context API
- **路由**：React Router
- **UI 组件库**：Ant Design / Material-UI / Tailwind CSS

### 2. API 客户端封装

创建统一的 API 客户端，便于后续维护：

```typescript
// src/api/client.ts
import axios from 'axios';

const apiClient = axios.create({
  baseURL: 'http://localhost:8080/api',
  headers: {
    'Content-Type': 'application/json',
  },
});

// Token 拦截器
apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('access_token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Token 刷新拦截器
apiClient.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401) {
      // 尝试刷新 token
      const refreshToken = localStorage.getItem('refresh_token');
      if (refreshToken) {
        try {
          const response = await axios.post('/api/auth/refresh', {
            refresh_token: refreshToken,
          });
          localStorage.setItem('access_token', response.data.access_token);
          // 重试原请求
          return apiClient.request(error.config);
        } catch (e) {
          // 刷新失败，跳转登录
          window.location.href = '/login';
        }
      }
    }
    return Promise.reject(error);
  }
);

export default apiClient;
```

### 3. Mock 数据策略（可选）

在等待后端接口时，可以使用 Mock：

```typescript
// src/api/mock.ts
export const mockDocs = [
  { id: 1, title: '测试文档1', owner_id: 1 },
  { id: 2, title: '测试文档2', owner_id: 1 },
];

// 或者使用 MSW (Mock Service Worker)
// https://mswjs.io/
```

**建议**：只在接口还未完成时使用，一旦后端接口可用，立即切换到真实 API。

---

## 📝 前端开发检查清单

### 第一阶段前端开发

- [ ] 项目初始化（React + TypeScript + Vite/CRA）
- [ ] 路由配置（React Router）
- [ ] API 客户端封装（axios）
- [ ] Token 管理（localStorage）
- [ ] 登录页面
- [ ] 注册页面
- [ ] 用户资料页面
- [ ] 路由守卫（Protected Route）
- [ ] 错误处理（统一错误提示）

### 第二阶段前端开发

- [ ] 文档列表页面
- [ ] 文档创建页面
- [ ] 文档详情页面
- [ ] 文档编辑页面
- [ ] 权限管理界面（ACL）
- [ ] 版本历史查看
- [ ] 分页组件
- [ ] 标签选择组件

### 第三阶段前端开发

- [ ] Tiptap 编辑器集成
- [ ] Yjs CRDT 集成
- [ ] WebSocket 连接管理
- [ ] 实时协作 UI（光标、用户列表）
- [ ] 评论系统 UI
- [ ] 任务管理 UI

---

## 🤝 前后端协作建议

### 1. API 契约优先

- 使用 OpenAPI/Swagger 定义 API 规格
- 前端根据 API 规格生成 TypeScript 类型
- 确保前后端对接口的理解一致

### 2. 定期沟通

- 每个阶段开始前，前后端确认接口设计
- 阶段完成后，前后端一起测试集成
- 发现问题及时沟通和调整

### 3. 接口版本管理

- 如果接口需要变更，使用版本号（如 `/api/v1/docs`）
- 避免破坏性变更影响前端开发

### 4. 测试驱动

- 后端提供接口测试用例
- 前端提供 E2E 测试用例
- 确保集成质量

---

## 🚀 当前建议

基于你已完成第一阶段后端的情况：

### 立即开始的工作

1. **前端项目初始化**
   - 创建 React + TypeScript 项目
   - 配置开发环境
   - 设置 API 客户端

2. **第一阶段前端实现**
   - 实现登录/注册功能
   - 实现用户资料管理
   - 与后端 API 集成测试

3. **准备第二阶段**
   - 搭建文档管理相关的页面框架
   - 设计路由结构
   - 等待第二阶段后端完成后集成

### 不建议现在做的

- ❌ 不要实现第二阶段的前端功能（后端接口还没完成）
- ❌ 不要过度设计（先实现 MVP，再优化）
- ❌ 不要完全依赖 Mock（后端接口可用后立即切换）

---

## 📚 参考资源

- [React 官方文档](https://react.dev/)
- [TypeScript 官方文档](https://www.typescriptlang.org/)
- [Tiptap 文档](https://tiptap.dev/)
- [Yjs 文档](https://docs.yjs.dev/)
- [后端 API 测试方法](./后端API测试方法.md)

---

## 💡 总结

**最佳实践**：阶段化同步开发

1. ✅ 第一阶段后端完成 → 前端实现第一阶段功能
2. ✅ 第二阶段后端完成 → 前端实现第二阶段功能
3. ✅ 第三阶段前后端紧密配合（实时协作）

**关键原则**：

- 每个阶段完成后立即集成
- 及早发现接口设计问题
- 保持可演示的增量进度
- 前后端定期沟通

**你现在应该做的**：

- 🎯 开始前端项目初始化
- 🎯 实现第一阶段的前端功能（登录/注册/用户资料）
- 🎯 等待第二阶段后端完成后，再实现文档管理功能
