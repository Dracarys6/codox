# ç¬¬å››é˜¶æ®µå¼€å‘æŒ‡å—ï¼šæ–‡æ¡£å¯¼å…¥å¯¼å‡ºã€æ¨¡æ¿ç³»ç»Ÿä¸è¿ç»´ç›‘æ§

## ğŸ¯ ç¬¬å››é˜¶æ®µç›®æ ‡

å®Œæˆæ–‡æ¡£çš„å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ã€æ¨¡æ¿ç³»ç»Ÿã€ç§»åŠ¨ç«¯æ”¯æŒä»¥åŠç”Ÿäº§ç¯å¢ƒçš„ç›‘æ§ä¸æ—¥å¿—ç³»ç»Ÿã€‚

---

## ğŸ“‹ å¼€å‘ä»»åŠ¡æ¦‚è§ˆ

### 1. æ–‡æ¡£å¯¼å…¥å¯¼å‡ºï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

- [ ] **Word æ–‡æ¡£å¯¼å…¥å¯¼å‡º**
  - [ ] åç«¯ï¼šé›†æˆ docx è§£æåº“ï¼ˆå¦‚ `mammoth` æˆ– C++ åº“ï¼‰
  - [ ] åç«¯ï¼šå®ç° Word å¯¼å…¥æ¥å£ (`POST /api/documents/import/word`)
  - [ ] åç«¯ï¼šå®ç° Word å¯¼å‡ºæ¥å£ (`GET /api/documents/:id/export/word`)
  - [ ] å‰ç«¯ï¼šä¸Šä¼  Word æ–‡ä»¶å¯¼å…¥
  - [ ] å‰ç«¯ï¼šå¯¼å‡ºä¸º Word æ–‡ä»¶

- [ ] **PDF æ–‡æ¡£å¯¼å…¥å¯¼å‡º**
  - [ ] åç«¯ï¼šé›†æˆ PDF è§£æåº“ï¼ˆå¦‚ `pdf-lib` æˆ– C++ åº“ï¼‰
  - [ ] åç«¯ï¼šå®ç° PDF å¯¼å…¥æ¥å£ (`POST /api/documents/import/pdf`)
  - [ ] åç«¯ï¼šå®ç° PDF å¯¼å‡ºæ¥å£ (`GET /api/documents/:id/export/pdf`)
  - [ ] å‰ç«¯ï¼šä¸Šä¼  PDF æ–‡ä»¶å¯¼å…¥
  - [ ] å‰ç«¯ï¼šå¯¼å‡ºä¸º PDF æ–‡ä»¶

- [ ] **Markdown å¯¼å…¥å¯¼å‡º**
  - [ ] åç«¯ï¼šå®ç° Markdown å¯¼å…¥æ¥å£ (`POST /api/documents/import/markdown`)
  - [ ] åç«¯ï¼šå®ç° Markdown å¯¼å‡ºæ¥å£ (`GET /api/documents/:id/export/markdown`)
  - [ ] å‰ç«¯ï¼šä¸Šä¼  Markdown æ–‡ä»¶å¯¼å…¥
  - [ ] å‰ç«¯ï¼šå¯¼å‡ºä¸º Markdown æ–‡ä»¶

### 2. æ–‡æ¡£æ¨¡æ¿ç³»ç»Ÿï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰

- [ ] **æ¨¡æ¿ç®¡ç†**
  - [ ] æ•°æ®åº“ï¼šåˆ›å»º `template` è¡¨
  - [ ] åç«¯ï¼šæ¨¡æ¿ CRUD æ¥å£
  - [ ] åç«¯ï¼šä»æ¨¡æ¿åˆ›å»ºæ–‡æ¡£æ¥å£
  - [ ] å‰ç«¯ï¼šæ¨¡æ¿åˆ—è¡¨é¡µé¢
  - [ ] å‰ç«¯ï¼šæ¨¡æ¿åˆ›å»º/ç¼–è¾‘é¡µé¢
  - [ ] å‰ç«¯ï¼šä»æ¨¡æ¿åˆ›å»ºæ–‡æ¡£åŠŸèƒ½

- [ ] **é¢„è®¾æ¨¡æ¿**
  - [ ] ä¼šè®®çºªè¦æ¨¡æ¿
  - [ ] é¡¹ç›®è®¡åˆ’æ¨¡æ¿
  - [ ] æŠ€æœ¯æ–‡æ¡£æ¨¡æ¿
  - [ ] éœ€æ±‚æ–‡æ¡£æ¨¡æ¿

### 3. ç§»åŠ¨ç«¯æ”¯æŒï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰

- [ ] **PWA é…ç½®**
  - [ ] å‰ç«¯ï¼šé…ç½® Service Worker
  - [ ] å‰ç«¯ï¼šé…ç½® Web App Manifest
  - [ ] å‰ç«¯ï¼šç¦»çº¿æ”¯æŒ
  - [ ] å‰ç«¯ï¼šå®‰è£…æç¤º

- [ ] **å“åº”å¼ä¼˜åŒ–**
  - [ ] ç§»åŠ¨ç«¯ç¼–è¾‘å™¨é€‚é…
  - [ ] ç§»åŠ¨ç«¯å¯¼èˆªä¼˜åŒ–
  - [ ] è§¦æ‘¸æ‰‹åŠ¿æ”¯æŒ

### 4. ç›‘æ§ä¸å‘Šè­¦ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

- [ ] **Prometheus é›†æˆ**
  - [ ] åç«¯ï¼šæš´éœ² Prometheus metrics ç«¯ç‚¹
  - [ ] åç«¯ï¼šæ·»åŠ ä¸šåŠ¡æŒ‡æ ‡ï¼ˆè¯·æ±‚æ•°ã€é”™è¯¯ç‡ã€å“åº”æ—¶é—´ç­‰ï¼‰
  - [ ] é…ç½®ï¼šPrometheus æœåŠ¡é…ç½®
  - [ ] é…ç½®ï¼šGrafana ä»ªè¡¨æ¿é…ç½®

- [ ] **å¥åº·æ£€æŸ¥å¢å¼º**
  - [ ] åç«¯ï¼šè¯¦ç»†çš„å¥åº·æ£€æŸ¥æ¥å£ï¼ˆæ•°æ®åº“ã€Meilisearchã€MinIO çŠ¶æ€ï¼‰
  - [ ] å‰ç«¯ï¼šå¥åº·çŠ¶æ€å±•ç¤º

### 5. é›†ä¸­æ—¥å¿—ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

- [ ] **æ—¥å¿—èšåˆ**
  - [ ] åç«¯ï¼šç»“æ„åŒ–æ—¥å¿—è¾“å‡ºï¼ˆJSON æ ¼å¼ï¼‰
  - [ ] é…ç½®ï¼šLoki æˆ– ELK é›†æˆ
  - [ ] é…ç½®ï¼šæ—¥å¿—æ”¶é›†é…ç½®

- [ ] **æ—¥å¿—æŸ¥è¯¢ä¸åˆ†æ**
  - [ ] Grafana æ—¥å¿—æŸ¥è¯¢ç•Œé¢
  - [ ] é”™è¯¯æ—¥å¿—å‘Šè­¦è§„åˆ™

---

## ğŸš€ å¼€å‘æ­¥éª¤

### æ­¥éª¤ 1ï¼šæ–‡æ¡£å¯¼å…¥å¯¼å‡ºåŠŸèƒ½

#### 1.1 Word æ–‡æ¡£å¯¼å…¥å¯¼å‡º

**æŠ€æœ¯é€‰å‹å»ºè®®**ï¼š
- **C++ åç«¯**: ä½¿ç”¨ `libdocx` æˆ–é€šè¿‡ Node.js æœåŠ¡è°ƒç”¨ `mammoth`
- **Node.js æœåŠ¡**: åˆ›å»ºç‹¬ç«‹çš„æ–‡æ¡£è½¬æ¢æœåŠ¡ï¼Œä½¿ç”¨ `mammoth` (Word â†’ HTML) å’Œ `docx` (HTML â†’ Word)

**å®ç°æ­¥éª¤**ï¼š

1. **åˆ›å»ºæ–‡æ¡£è½¬æ¢æœåŠ¡**ï¼ˆå¯é€‰ï¼Œæ¨èï¼‰
   ```bash
   mkdir -p doc-converter-service
   cd doc-converter-service
   npm init -y
   npm install mammoth docx pdf-lib marked
   ```

2. **åç«¯æ¥å£å®ç°**
   - åˆ›å»º `DocumentImportExportController`
   - å®ç°å¯¼å…¥æ¥å£ï¼šæ¥æ”¶æ–‡ä»¶ä¸Šä¼ ï¼Œè°ƒç”¨è½¬æ¢æœåŠ¡ï¼Œåˆ›å»ºæ–‡æ¡£
   - å®ç°å¯¼å‡ºæ¥å£ï¼šè·å–æ–‡æ¡£å†…å®¹ï¼Œè°ƒç”¨è½¬æ¢æœåŠ¡ï¼Œè¿”å›æ–‡ä»¶

3. **å‰ç«¯å®ç°**
   - æ–‡ä»¶ä¸Šä¼ ç»„ä»¶
   - å¯¼å‡ºæŒ‰é’®å’Œä¸‹è½½åŠŸèƒ½

#### 1.2 PDF æ–‡æ¡£å¯¼å…¥å¯¼å‡º

**æŠ€æœ¯é€‰å‹**ï¼š
- ä½¿ç”¨ `pdf-lib` è¿›è¡Œ PDF æ“ä½œ
- ä½¿ç”¨ `pdf-parse` è§£æ PDF æ–‡æœ¬

#### 1.3 Markdown å¯¼å…¥å¯¼å‡º

**æŠ€æœ¯é€‰å‹**ï¼š
- ä½¿ç”¨ `marked` è§£æ Markdown
- Tiptap åŸç”Ÿæ”¯æŒ Markdown

### æ­¥éª¤ 2ï¼šæ–‡æ¡£æ¨¡æ¿ç³»ç»Ÿ

#### 2.1 æ•°æ®åº“è®¾è®¡

```sql
CREATE TABLE template (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    content JSONB NOT NULL,  -- Tiptap JSON æ ¼å¼
    category VARCHAR(50),    -- æ¨¡æ¿åˆ†ç±»
    is_public BOOLEAN DEFAULT false,
    created_by INTEGER REFERENCES "user"(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 2.2 åç«¯å®ç°

- åˆ›å»º `TemplateController`
- å®ç°æ¨¡æ¿ CRUD æ¥å£
- å®ç°ä»æ¨¡æ¿åˆ›å»ºæ–‡æ¡£æ¥å£

#### 2.3 å‰ç«¯å®ç°

- æ¨¡æ¿åˆ—è¡¨é¡µé¢
- æ¨¡æ¿åˆ›å»º/ç¼–è¾‘é¡µé¢
- ä»æ¨¡æ¿åˆ›å»ºæ–‡æ¡£åŠŸèƒ½

### æ­¥éª¤ 3ï¼šç§»åŠ¨ç«¯æ”¯æŒï¼ˆPWAï¼‰

#### 3.1 Service Worker é…ç½®

åœ¨ `frontend/public` ç›®å½•åˆ›å»º `sw.js`ï¼š

```javascript
// sw.js
const CACHE_NAME = 'codox-v1';
const urlsToCache = [
  '/',
  '/static/css/main.css',
  '/static/js/main.js'
];

self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then((cache) => cache.addAll(urlsToCache))
  );
});

self.addEventListener('fetch', (event) => {
  event.respondWith(
    caches.match(event.request)
      .then((response) => response || fetch(event.request))
  );
});
```

#### 3.2 Web App Manifest

åˆ›å»º `frontend/public/manifest.json`ï¼š

```json
{
  "name": "Codox - åä½œæ–‡æ¡£ç³»ç»Ÿ",
  "short_name": "Codox",
  "description": "å¤šäººåœ¨çº¿åä½œæ–‡æ¡£ç³»ç»Ÿ",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#000000",
  "icons": [
    {
      "src": "/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

#### 3.3 å“åº”å¼ä¼˜åŒ–

- ä½¿ç”¨ Tailwind CSS å“åº”å¼ç±»
- ä¼˜åŒ–ç§»åŠ¨ç«¯ç¼–è¾‘å™¨ä½“éªŒ
- æ·»åŠ è§¦æ‘¸æ‰‹åŠ¿æ”¯æŒ

### æ­¥éª¤ 4ï¼šç›‘æ§ä¸å‘Šè­¦

#### 4.1 Prometheus Metrics

åœ¨åç«¯æ·»åŠ  Prometheus metricsï¼š

```cpp
// ä½¿ç”¨ drogon çš„ metrics æ”¯æŒæˆ–é›†æˆ prometheus-cpp
// æš´éœ² /metrics ç«¯ç‚¹
```

#### 4.2 Grafana ä»ªè¡¨æ¿

åˆ›å»º Grafana ä»ªè¡¨æ¿é…ç½®ï¼Œç›‘æ§ï¼š
- è¯·æ±‚é€Ÿç‡
- é”™è¯¯ç‡
- å“åº”æ—¶é—´
- æ•°æ®åº“è¿æ¥æ± çŠ¶æ€
- ç³»ç»Ÿèµ„æºä½¿ç”¨

### æ­¥éª¤ 5ï¼šé›†ä¸­æ—¥å¿—

#### 5.1 ç»“æ„åŒ–æ—¥å¿—

åç«¯ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—æ ¼å¼ï¼ˆJSONï¼‰ï¼š

```cpp
// ä½¿ç”¨ drogon çš„æ—¥å¿—ç³»ç»Ÿï¼Œè¾“å‡º JSON æ ¼å¼
LOG_INFO << json::value({
    {"level", "info"},
    {"message", "Request processed"},
    {"timestamp", getCurrentTime()}
});
```

#### 5.2 Loki é›†æˆ

é…ç½® Loki æ”¶é›†æ—¥å¿—ï¼š

```yaml
# docker-compose.yml
loki:
  image: grafana/loki:latest
  ports:
    - "3100:3100"
  volumes:
    - ./loki-config.yaml:/etc/loki/local-config.yaml
```

---

## ğŸ“ å¼€å‘å»ºè®®

### ä¼˜å…ˆçº§å»ºè®®

1. **æ–‡æ¡£å¯¼å…¥å¯¼å‡º**ï¼šæå‡ç”¨æˆ·ä½“éªŒï¼Œä¼˜å…ˆçº§æœ€é«˜
2. **ç›‘æ§ä¸å‘Šè­¦**ï¼šç”Ÿäº§ç¯å¢ƒå¿…éœ€ï¼Œä¼˜å…ˆçº§é«˜
3. **é›†ä¸­æ—¥å¿—**ï¼šä¾¿äºé—®é¢˜æ’æŸ¥ï¼Œä¼˜å…ˆçº§é«˜
4. **æ¨¡æ¿ç³»ç»Ÿ**ï¼šæå‡æ•ˆç‡ï¼Œä¼˜å…ˆçº§ä¸­
5. **ç§»åŠ¨ç«¯æ”¯æŒ**ï¼šæ‰©å±•ä½¿ç”¨åœºæ™¯ï¼Œä¼˜å…ˆçº§ä¸­

### æŠ€æœ¯é€‰å‹å»ºè®®

- **æ–‡æ¡£è½¬æ¢**ï¼šè€ƒè™‘åˆ›å»ºç‹¬ç«‹çš„ Node.js æœåŠ¡ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **ç›‘æ§**ï¼šPrometheus + Grafana æ˜¯æˆç†Ÿæ–¹æ¡ˆ
- **æ—¥å¿—**ï¼šLoki è½»é‡çº§ï¼ŒELK åŠŸèƒ½æ›´å¼ºå¤§ä½†èµ„æºæ¶ˆè€—æ›´å¤§

### æµ‹è¯•å»ºè®®

- å¯¼å…¥å¯¼å‡ºåŠŸèƒ½éœ€è¦æµ‹è¯•å„ç§æ ¼å¼çš„æ–‡æ¡£
- æ¨¡æ¿ç³»ç»Ÿéœ€è¦æµ‹è¯•æ¨¡æ¿åˆ›å»ºå’Œæ–‡æ¡£ç”Ÿæˆ
- PWA éœ€è¦åœ¨çœŸå®ç§»åŠ¨è®¾å¤‡ä¸Šæµ‹è¯•
- ç›‘æ§å’Œæ—¥å¿—éœ€è¦éªŒè¯æ•°æ®æ”¶é›†å’ŒæŸ¥è¯¢

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®å¯åŠ¨æŒ‡å—](./GUIDE-01-é¡¹ç›®å¯åŠ¨æŒ‡å—.md)
- [æ€»ä½“è®¾è®¡æ–‡æ¡£](./ARCH-01-æ€»ä½“è®¾è®¡.md)
- [ç¬¬ä¸‰é˜¶æ®µå¼€å‘æŒ‡å—](./PHASE-03-åä½œåŠŸèƒ½å¼€å‘æŒ‡å—.md)

---

**ç¥å¼€å‘é¡ºåˆ©ï¼** ğŸš€

