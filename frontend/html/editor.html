<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文档编辑 - Codox</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- 配置Tailwind自定义主题 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        danger: '#EF4444',
                        warning: '#F59E0B',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                },
            }
        }
    </script>

    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .bg-gradient-primary {
        background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .transition-custom {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
    }
  </style>

    <style>
        /* 编辑器样式 */
        #editor {
            min-height: 600px;
            line-height: 1.8;
        }

        #editor:focus {
            outline: none;
        }

        #editor h1 {
            font-size: 2em;
            font-weight: bold;
            margin: 0.67em 0;
        }

        #editor h2 {
            font-size: 1.5em;
            font-weight: bold;
            margin: 0.75em 0;
        }

        #editor h3 {
            font-size: 1.17em;
            font-weight: bold;
            margin: 0.83em 0;
        }

        #editor p {
            margin: 1em 0;
        }

        #editor ul,
        #editor ol {
            margin: 1em 0;
            padding-left: 2em;
        }

        #editor blockquote {
            border-left: 4px solid #3B82F6;
            padding-left: 1em;
            margin: 1em 0;
            color: #6B7280;
        }

        #editor code {
            background-color: #F3F4F6;
            padding: 0.2em 0.4em;
            border-radius: 0.25rem;
            font-family: monospace;
        }

        #editor pre {
            background-color: #F3F4F6;
            padding: 1em;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin: 1em 0;
        }
    </style>
</head>

<body class="font-inter bg-gray-50 text-dark min-h-screen flex flex-col">
    <!-- 导航栏 -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <!-- 左侧Logo和文档信息 -->
                <div class="flex items-center flex-1 min-w-0">
                    <a href="home.html" class="flex-shrink-0 flex items-center mr-6">
                        <div class="bg-primary text-white p-1.5 rounded-lg">
                            <i class="fa fa-file-text-o text-xl"></i>
                        </div>
                        <span class="ml-2 text-xl font-bold hidden md:block">Codox</span>
                    </a>

                    <div class="flex-1 min-w-0">
                        <input type="text" id="documentTitle" value="产品规划方案"
                            class="text-lg font-semibold bg-transparent border-none focus:outline-none focus:ring-2 focus:ring-primary/50 rounded px-2 py-1 w-full max-w-md"
                            placeholder="未命名文档">
                    </div>
                </div>

                <!-- 中间工具栏 -->
                <div class="hidden lg:flex items-center gap-2 px-4">
                    <!-- 保存状态 -->
                    <div id="saveStatus" class="flex items-center text-sm text-gray-500 mr-4">
                        <i class="fa fa-check-circle text-secondary mr-1"></i>
                        <span>已保存</span>
                    </div>

                    <!-- 协作用户 -->
                    <div class="flex items-center -space-x-2 mr-4">
                        <div class="h-8 w-8 rounded-full bg-primary border-2 border-white flex items-center justify-center text-white text-xs font-semibold"
                            title="张小明">
                            张
                        </div>
                        <div class="h-8 w-8 rounded-full bg-secondary border-2 border-white flex items-center justify-center text-white text-xs font-semibold"
                            title="李小红">
                            李
                        </div>
                        <div class="h-8 w-8 rounded-full bg-warning border-2 border-white flex items-center justify-center text-white text-xs font-semibold"
                            title="王小强">
                            王
                        </div>
                        <button type="button"
                            class="h-8 w-8 rounded-full bg-gray-200 border-2 border-white flex items-center justify-center text-gray-600 text-xs hover:bg-gray-300 transition-custom"
                            title="邀请协作者">
                            <i class="fa fa-plus"></i>
                        </button>
                    </div>
                </div>

                <!-- 右侧操作按钮 -->
                <div class="flex items-center gap-2">
                    <button type="button"
                        class="p-2 rounded-lg text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-custom"
                        title="评论">
                        <i class="fa fa-comment-o"></i>
                    </button>
                    <button type="button"
                        class="p-2 rounded-lg text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-custom"
                        title="分享">
                        <i class="fa fa-share-alt"></i>
                    </button>
                    <button type="button"
                        class="p-2 rounded-lg text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-custom"
                        title="更多">
                        <i class="fa fa-ellipsis-v"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- 工具栏 -->
    <div class="bg-white border-b border-gray-200 sticky top-16 z-40">
        <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center gap-1 py-2 overflow-x-auto">
                <button type="button" class="toolbar-btn p-2 rounded hover:bg-gray-100 transition-custom"
                    data-command="bold" title="粗体 (Ctrl+B)">
                    <i class="fa fa-bold"></i>
                </button>
                <button type="button" class="toolbar-btn p-2 rounded hover:bg-gray-100 transition-custom"
                    data-command="italic" title="斜体 (Ctrl+I)">
                    <i class="fa fa-italic"></i>
                </button>
                <button type="button" class="toolbar-btn p-2 rounded hover:bg-gray-100 transition-custom"
                    data-command="underline" title="下划线 (Ctrl+U)">
                    <i class="fa fa-underline"></i>
                </button>
                <div class="w-px h-6 bg-gray-300 mx-1"></div>
                <button type="button" class="toolbar-btn p-2 rounded hover:bg-gray-100 transition-custom"
                    data-command="formatBlock" data-value="h1" title="标题 1">
                    <i class="fa fa-header"></i> 1
                </button>
                <button type="button" class="toolbar-btn p-2 rounded hover:bg-gray-100 transition-custom"
                    data-command="formatBlock" data-value="h2" title="标题 2">
                    <i class="fa fa-header"></i> 2
                </button>
                <button type="button" class="toolbar-btn p-2 rounded hover:bg-gray-100 transition-custom"
                    data-command="formatBlock" data-value="h3" title="标题 3">
                    <i class="fa fa-header"></i> 3
                </button>
                <div class="w-px h-6 bg-gray-300 mx-1"></div>
                <button type="button" class="toolbar-btn p-2 rounded hover:bg-gray-100 transition-custom"
                    data-command="insertUnorderedList" title="无序列表">
                    <i class="fa fa-list-ul"></i>
                </button>
                <button type="button" class="toolbar-btn p-2 rounded hover:bg-gray-100 transition-custom"
                    data-command="insertOrderedList" title="有序列表">
                    <i class="fa fa-list-ol"></i>
                </button>
                <button type="button" class="toolbar-btn p-2 rounded hover:bg-gray-100 transition-custom"
                    data-command="formatBlock" data-value="blockquote" title="引用">
                    <i class="fa fa-quote-right"></i>
                </button>
                <div class="w-px h-6 bg-gray-300 mx-1"></div>
                <button type="button" class="toolbar-btn p-2 rounded hover:bg-gray-100 transition-custom"
                    data-command="createLink" title="插入链接">
                    <i class="fa fa-link"></i>
                </button>
                <button type="button" class="toolbar-btn p-2 rounded hover:bg-gray-100 transition-custom"
                    data-command="insertImage" title="插入图片">
                    <i class="fa fa-image"></i>
                </button>
                <div class="w-px h-6 bg-gray-300 mx-1"></div>
                <button type="button" class="toolbar-btn p-2 rounded hover:bg-gray-100 transition-custom"
                    data-command="undo" title="撤销 (Ctrl+Z)">
                    <i class="fa fa-undo"></i>
                </button>
                <button type="button" class="toolbar-btn p-2 rounded hover:bg-gray-100 transition-custom"
                    data-command="redo" title="重做 (Ctrl+Y)">
                    <i class="fa fa-repeat"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 主内容区 -->
    <main class="flex-grow flex">
        <!-- 编辑器区域 -->
        <div class="flex-1 flex flex-col">
            <div class="flex-1 bg-white mx-auto w-full max-w-4xl px-8 md:px-16 py-8">
                <div id="editor" contenteditable="true" class="prose max-w-none focus:outline-none">
                    <h1>产品规划方案</h1>
                    <p>这是一份产品规划方案的示例文档。您可以在这里开始编辑内容。</p>
                    <h2>项目概述</h2>
                    <p>本项目旨在开发一款创新的产品，满足用户的核心需求。</p>
                    <h3>目标用户</h3>
                    <ul>
                        <li>目标用户群体1</li>
                        <li>目标用户群体2</li>
                        <li>目标用户群体3</li>
                    </ul>
                    <h2>功能特性</h2>
                    <p>产品将包含以下核心功能：</p>
                    <ol>
                        <li>功能特性1</li>
                        <li>功能特性2</li>
                        <li>功能特性3</li>
                    </ol>
                    <blockquote>
                        <p>这是一个引用示例，用于突出重要信息。</p>
                    </blockquote>
                </div>
            </div>
        </div>

        <!-- 右侧边栏（可选） -->
        <aside class="hidden xl:block w-64 bg-gray-50 border-l border-gray-200 p-4">
            <div class="space-y-6">
                <!-- 文档信息 -->
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 mb-3">文档信息</h3>
                    <div class="space-y-2 text-sm text-gray-600">
                        <div class="flex justify-between">
                            <span>创建时间</span>
                            <span>2023-06-01</span>
                        </div>
                        <div class="flex justify-between">
                            <span>最后修改</span>
                            <span>今天 14:30</span>
                        </div>
                        <div class="flex justify-between">
                            <span>字数统计</span>
                            <span id="wordCount">0</span>
                        </div>
                    </div>
                </div>

                <!-- 协作者 -->
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 mb-3">协作者</h3>
                    <div class="space-y-2">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div
                                    class="h-8 w-8 rounded-full bg-primary text-white flex items-center justify-center text-xs font-semibold mr-2">
                                    张
                                </div>
                                <span class="text-sm text-gray-700">张小明</span>
                            </div>
                            <span class="text-xs text-gray-500">所有者</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div
                                    class="h-8 w-8 rounded-full bg-secondary text-white flex items-center justify-center text-xs font-semibold mr-2">
                                    李
                                </div>
                                <span class="text-sm text-gray-700">李小红</span>
                            </div>
                            <span class="text-xs text-secondary">在线</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div
                                    class="h-8 w-8 rounded-full bg-warning text-white flex items-center justify-center text-xs font-semibold mr-2">
                                    王
                                </div>
                                <span class="text-sm text-gray-700">王小强</span>
                            </div>
                            <span class="text-xs text-gray-500">离线</span>
                        </div>
                    </div>
                    <button type="button"
                        class="mt-3 w-full text-sm text-primary hover:text-primary/80 transition-custom">
                        <i class="fa fa-plus mr-1"></i>邀请协作者
                    </button>
                </div>

                <!-- 版本历史 -->
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 mb-3">版本历史</h3>
                    <div class="space-y-2 text-sm">
                        <button type="button"
                            class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 transition-custom">
                            <div class="font-medium text-gray-900">当前版本</div>
                            <div class="text-xs text-gray-500">今天 14:30</div>
                        </button>
                        <button type="button"
                            class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 transition-custom">
                            <div class="font-medium text-gray-900">版本 2</div>
                            <div class="text-xs text-gray-500">昨天 09:15</div>
                        </button>
                        <button type="button"
                            class="w-full text-left px-3 py-2 rounded hover:bg-gray-100 transition-custom">
                            <div class="font-medium text-gray-900">版本 1</div>
                            <div class="text-xs text-gray-500">2023-06-01</div>
                        </button>
                    </div>
                    <button type="button"
                        class="mt-3 w-full text-sm text-primary hover:text-primary/80 transition-custom">
                        查看全部历史
                    </button>
                </div>
            </div>
        </aside>
    </main>

    <!-- JavaScript -->
    <script>
        const editor = document.getElementById('editor');
        const toolbarButtons = document.querySelectorAll('.toolbar-btn');
        const saveStatus = document.getElementById('saveStatus');
        const wordCount = document.getElementById('wordCount');

        // 工具栏按钮点击事件
        toolbarButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                const command = btn.dataset.command;
                const value = btn.dataset.value;

                if (command === 'createLink') {
                    const url = prompt('请输入链接地址:');
                    if (url) {
                        document.execCommand(command, false, url);
                    }
                } else if (command === 'insertImage') {
                    const url = prompt('请输入图片地址:');
                    if (url) {
                        document.execCommand(command, false, url);
                    }
                } else if (value) {
                    document.execCommand(command, false, value);
                } else {
                    document.execCommand(command, false, null);
                }

                updateToolbarState();
                markUnsaved();
            });
        });

        // 更新工具栏按钮状态
        function updateToolbarState() {
            toolbarButtons.forEach(btn => {
                const command = btn.dataset.command;
                if (command === 'bold' || command === 'italic' || command === 'underline') {
                    if (document.queryCommandState(command)) {
                        btn.classList.add('bg-gray-200');
                    } else {
                        btn.classList.remove('bg-gray-200');
                    }
                }
            });
        }

        // 编辑器内容变化
        let saveTimer;
        editor.addEventListener('input', () => {
            updateWordCount();
            markUnsaved();

            // 自动保存（模拟）
            clearTimeout(saveTimer);
            saveTimer = setTimeout(() => {
                saveDocument();
            }, 2000);
        });

        // 更新字数统计
        function updateWordCount() {
            const text = editor.innerText || editor.textContent || '';
            const words = text.trim().split(/\s+/).filter(word => word.length > 0);
            wordCount.textContent = words.length;
        }

        // 标记为未保存
        function markUnsaved() {
            saveStatus.innerHTML = '<i class="fa fa-circle text-warning mr-1"></i><span>保存中...</span>';
            saveStatus.className = 'flex items-center text-sm text-warning mr-4';
        }

        // 保存文档
        function saveDocument() {
            // 模拟保存
            setTimeout(() => {
                saveStatus.innerHTML = '<i class="fa fa-check-circle text-secondary mr-1"></i><span>已保存</span>';
                saveStatus.className = 'flex items-center text-sm text-secondary mr-4';
            }, 500);
        }

        // 键盘快捷键
        editor.addEventListener('keydown', (e) => {
            // Ctrl+B: 粗体
            if (e.ctrlKey && e.key === 'b') {
                e.preventDefault();
                document.execCommand('bold', false, null);
                updateToolbarState();
                markUnsaved();
            }
            // Ctrl+I: 斜体
            if (e.ctrlKey && e.key === 'i') {
                e.preventDefault();
                document.execCommand('italic', false, null);
                updateToolbarState();
                markUnsaved();
            }
            // Ctrl+U: 下划线
            if (e.ctrlKey && e.key === 'u') {
                e.preventDefault();
                document.execCommand('underline', false, null);
                updateToolbarState();
                markUnsaved();
            }
            // Ctrl+Z: 撤销
            if (e.ctrlKey && e.key === 'z' && !e.shiftKey) {
                e.preventDefault();
                document.execCommand('undo', false, null);
                markUnsaved();
            }
            // Ctrl+Y 或 Ctrl+Shift+Z: 重做
            if ((e.ctrlKey && e.key === 'y') || (e.ctrlKey && e.shiftKey && e.key === 'z')) {
                e.preventDefault();
                document.execCommand('redo', false, null);
                markUnsaved();
            }
        });

        // 文档标题变化
        document.getElementById('documentTitle').addEventListener('input', () => {
            markUnsaved();
            setTimeout(() => {
                saveDocument();
            }, 2000);
        });

        // 初始化
        updateWordCount();
        updateToolbarState();

        // 防止意外离开页面
        let hasUnsavedChanges = false;
        editor.addEventListener('input', () => {
            hasUnsavedChanges = true;
        });

        window.addEventListener('beforeunload', (e) => {
            if (hasUnsavedChanges) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>

</html>